(()=>{"use strict";var e,r,t={139:(e,r,t)=>{t.d(r,{Ol:()=>s,VZ:()=>a});const a={MAX_FILENAME_LENGTH:255,MAX_DESCRIPTION_LENGTH:1e3,MAX_USAGE_LENGTH:2e3,MAX_NOTES_LENGTH:1e3,MAX_TODO_LENGTH:1e3,MAX_DEPENDENCIES_LENGTH:500},s={GENERATE_HEADER:"GENERATE_HEADER",EXPORT_HEADER:"EXPORT_HEADER",SAVE_PREFERENCES:"SAVE_PREFERENCES",LOAD_PREFERENCES:"LOAD_PREFERENCES",UPDATE_THEME:"UPDATE_THEME",VALIDATE_DATA:"VALIDATE_DATA",GET_LANGUAGES:"GET_LANGUAGES",GET_TEMPLATE:"GET_TEMPLATE"};"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}},a={};function s(e){var r=a[e];if(void 0!==r)return r.exports;var n=a[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.m=t,s.d=(e,r)=>{for(var t in r)s.o(r,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((r,t)=>(s.f[t](e,r),r),[])),s.u=e=>"common/common.js",s.miniCssF=e=>"common/common.css",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),e={},r="headforge:",s.l=(t,a,n,o)=>{if(e[t])e[t].push(a);else{var i,c;if(void 0!==n)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==r+n){i=u;break}}i||(c=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.setAttribute("data-webpack",r+n),i.src=t),e[t]=[a];var h=(r,a)=>{i.onerror=i.onload=null,clearTimeout(E);var s=e[t];if(delete e[t],i.parentNode&&i.parentNode.removeChild(i),s&&s.forEach(e=>e(a)),r)return r(a)},E=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),c&&document.head.appendChild(i)}},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var r=s.g.document;if(!e&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(e=r.currentScript.src),!e)){var t=r.getElementsByTagName("script");if(t.length)for(var a=t.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=t[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e+"../"})(),(()=>{if("undefined"!=typeof document){var e=e=>new Promise((r,t)=>{var a=s.miniCssF(e),n=s.p+a;if(((e,r)=>{for(var t=document.getElementsByTagName("link"),a=0;a<t.length;a++){var s=(o=t[a]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(s===e||s===r))return o}var n=document.getElementsByTagName("style");for(a=0;a<n.length;a++){var o;if((s=(o=n[a]).getAttribute("data-href"))===e||s===r)return o}})(a,n))return r();((e,r,t,a,n)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",s.nc&&(o.nonce=s.nc),o.onerror=o.onload=t=>{if(o.onerror=o.onload=null,"load"===t.type)a();else{var s=t&&t.type,i=t&&t.target&&t.target.href||r,c=new Error("Loading CSS chunk "+e+" failed.\n("+s+": "+i+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=s,c.request=i,o.parentNode&&o.parentNode.removeChild(o),n(c)}},o.href=r,t?t.parentNode.insertBefore(o,t.nextSibling):document.head.appendChild(o)})(e,n,null,r,t)}),r={471:0};s.f.miniCss=(t,a)=>{r[t]?a.push(r[t]):0!==r[t]&&{76:1}[t]&&a.push(r[t]=e(t).then(()=>{r[t]=0},e=>{throw delete r[t],e}))}}})(),(()=>{var e={471:0};s.f.j=(r,t)=>{var a=s.o(e,r)?e[r]:void 0;if(0!==a)if(a)t.push(a[2]);else{var n=new Promise((t,s)=>a=e[r]=[t,s]);t.push(a[2]=n);var o=s.p+s.u(r),i=new Error;s.l(o,t=>{if(s.o(e,r)&&(0!==(a=e[r])&&(e[r]=void 0),a)){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;i.message="Loading chunk "+r+" failed.\n("+n+": "+o+")",i.name="ChunkLoadError",i.type=n,i.request=o,a[1](i)}},"chunk-"+r,r)}};var r=(r,t)=>{var a,n,[o,i,c]=t,l=0;if(o.some(r=>0!==e[r])){for(a in i)s.o(i,a)&&(s.m[a]=i[a]);if(c)c(s)}for(r&&r(t);l<o.length;l++)n=o[l],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0},t=self.webpackChunkheadforge=self.webpackChunkheadforge||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var n=s(139);new class{constructor(){this.browserAPI=this.getBrowserAPI(),this.setupMessageListener(),this.setupInstallListener(),this.setupUpdateListener()}getBrowserAPI(){const e=globalThis.browser||chrome;return{storage:{local:{get:r=>new Promise(t=>e.storage.local.get(r,t)),set:r=>new Promise(t=>e.storage.local.set(r,t)),remove:r=>new Promise(t=>e.storage.local.remove(r,t)),clear:()=>new Promise(r=>e.storage.local.clear(r))},sync:{get:r=>new Promise(t=>e.storage.sync.get(r,t)),set:r=>new Promise(t=>e.storage.sync.set(r,t)),remove:r=>new Promise(t=>e.storage.sync.remove(r,t)),clear:()=>new Promise(r=>e.storage.sync.clear(r))}},clipboard:{writeText:r=>new Promise((t,a)=>{e.clipboard&&e.clipboard.writeText?e.clipboard.writeText(r).then(t).catch(a):a(new Error("Clipboard API not available"))})},tabs:{query:r=>new Promise(t=>e.tabs.query(r,t)),sendMessage:(r,t)=>new Promise((a,s)=>{e.tabs.sendMessage(r,t,r=>{e.runtime.lastError?s(e.runtime.lastError):a(r)})})},runtime:{sendMessage:r=>new Promise((t,a)=>{e.runtime.sendMessage(r,r=>{e.runtime.lastError?a(e.runtime.lastError):t(r)})}),onMessage:{addListener:r=>{e.runtime.onMessage.addListener(r)},removeListener:r=>{e.runtime.onMessage.removeListener(r)}},onInstalled:{addListener:r=>{e.runtime.onInstalled.addListener(r)}},onStartup:{addListener:r=>{e.runtime.onStartup.addListener(r)}}}}}setupMessageListener(){this.browserAPI.runtime.onMessage.addListener((e,r,t)=>(this.handleMessage(e,r,t),!0))}async handleMessage(e,r,t){try{let r;switch(e.type){case n.Ol.GENERATE_HEADER:r=await this.handleGenerateHeader(e.payload);break;case n.Ol.EXPORT_HEADER:r=await this.handleExportHeader(e.payload);break;case n.Ol.SAVE_PREFERENCES:r=await this.handleSavePreferences(e.payload);break;case n.Ol.LOAD_PREFERENCES:r=await this.handleLoadPreferences();break;case n.Ol.UPDATE_THEME:r=await this.handleUpdateTheme(e.payload);break;case n.Ol.VALIDATE_DATA:r=await this.handleValidateData(e.payload);break;case n.Ol.GET_LANGUAGES:r=await this.handleGetLanguages();break;case n.Ol.GET_TEMPLATE:r=await this.handleGetTemplate(e.payload);break;default:r={error:"Unknown message type"}}t(r)}catch(e){t({error:e instanceof Error?e.message:"Unknown error"})}}async handleGenerateHeader(e){try{const{templateEngine:r}=await s.e(76).then(s.bind(s,377)),{getLanguageById:t}=await s.e(76).then(s.bind(s,156)),{headerData:a,languageId:n}=e,o=t(n);if(!o)throw new Error("Language not found");return{success:!0,headerContent:r.generateHeader(a,o),language:o}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleExportHeader(e){try{const{headerContent:r,exportOptions:t}=e;switch(t.format){case"clipboard":return await this.browserAPI.clipboard.writeText(r),{success:!0,message:"Header copied to clipboard"};case"file":return{success:!0,message:"File download initiated"};case"insert":return{success:!0,message:"Header insertion initiated"};default:throw new Error("Unknown export format")}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleSavePreferences(e){try{return await this.browserAPI.storage.sync.set({userPreferences:e}),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleLoadPreferences(){try{return{success:!0,preferences:(await this.browserAPI.storage.sync.get("userPreferences")).userPreferences||{}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleUpdateTheme(e){try{const{theme:r}=e;await this.browserAPI.storage.sync.set({theme:r});return(await this.browserAPI.tabs.query({})).forEach(e=>{e.id&&this.browserAPI.tabs.sendMessage(e.id,{type:"THEME_CHANGED",payload:{theme:r}}).catch(()=>{})}),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleValidateData(e){try{const{ValidationUtils:r}=await s.e(76).then(s.bind(s,371));return{success:!0,validation:r.validateHeaderData(e)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleGetLanguages(){try{const{languageConfigs:e}=await s.e(76).then(s.bind(s,156));return{success:!0,languages:e}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleGetTemplate(e){try{const{getLanguageById:r}=await s.e(76).then(s.bind(s,156)),{templateEngine:t}=await s.e(76).then(s.bind(s,377)),{languageId:a,headerData:n}=e,o=r(a);if(!o)throw new Error("Language not found");const i=o.template;return{success:!0,template:i,preview:t.generateHeader(n,o),language:o}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}setupInstallListener(){this.browserAPI.runtime.onInstalled.addListener(e=>{"install"===e.reason?this.handleInstall():"update"===e.reason&&this.handleUpdate(e.previousVersion)})}async handleInstall(){try{const e={theme:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",defaultLanguage:"javascript",defaultAuthor:"Satoshiba",defaultProject:"SYNCLY - YouTube PVR Extension",defaultLicense:"MIT",autoFillDates:!0,rememberLastValues:!0,exportFormat:"clipboard",showPreview:!0};await this.browserAPI.storage.sync.set({userPreferences:e})}catch(e){}}async handleUpdate(e){try{await this.migrateData(e)}catch(e){}}async migrateData(e){e&&this.isVersionLessThan(e,"1.1.0")}isVersionLessThan(e,r){const t=e.split(".").map(Number),a=r.split(".").map(Number);for(let e=0;e<Math.max(t.length,a.length);e++){const r=t[e]||0,s=a[e]||0;if(r<s)return!0;if(r>s)return!1}return!1}setupUpdateListener(){this.browserAPI.runtime.onStartup.addListener(()=>{})}}})();
//# sourceMappingURL=background.js.map