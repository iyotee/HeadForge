(()=>{"use strict";new class{constructor(){this.isActive=!1,this.currentEditor=null,this.setupMessageListener(),this.detectEditors(),this.setupKeyboardShortcuts()}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,r)=>(this.handleMessage(e,t,r),!0))}async handleMessage(e,t,r){try{let t;switch(e.type){case"INSERT_HEADER":t=await this.handleInsertHeader(e.payload);break;case"THEME_CHANGED":t=await this.handleThemeChanged(e.payload);break;case"DETECT_EDITOR":t=await this.detectCurrentEditor();break;default:t={error:"Unknown message type"}}r(t)}catch(e){r({error:e instanceof Error?e.message:"Unknown error"})}}async handleInsertHeader(e){try{const{headerContent:t,language:r}=e;if(!this.currentEditor)throw new Error("No active editor detected");return this.insertTextAtCursor(t),{success:!0,message:"Header inserted successfully"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async handleThemeChanged(e){try{const{theme:t}=e;return document.documentElement.setAttribute("data-headforge-theme",t),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async detectCurrentEditor(){try{const e=this.findActiveEditor();return{success:!0,editor:e?{type:this.getEditorType(e),element:e.tagName,id:e.id,className:e.className}:null}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}detectEditors(){const e=[".CodeMirror",".cm-editor",".monaco-editor",".ace_editor",'pre[class*="language-"]',"textarea[data-editor]",'textarea[class*="editor"]',".monaco-editor .view-lines",".blob-code-inner",".blob-code",".file-content","pre code","textarea",'[contenteditable="true"]'];new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const r=t;this.isEditor(r)&&this.setupEditor(r),e.forEach(e=>{r.querySelectorAll(e).forEach(e=>{this.setupEditor(e)})})}})})}).observe(document.body,{childList:!0,subtree:!0}),e.forEach(e=>{document.querySelectorAll(e).forEach(e=>{this.setupEditor(e)})})}setupEditor(e){e.addEventListener("focus",()=>{this.currentEditor=e,this.isActive=!0}),e.addEventListener("blur",()=>{this.isActive=!1}),e.addEventListener("click",()=>{this.currentEditor=e,this.isActive=!0}),e.addEventListener("keydown",t=>{"Tab"!==t.key&&"Enter"!==t.key||(this.currentEditor=e,this.isActive=!0)})}isEditor(e){if(["textarea","pre","code",'div[contenteditable="true"]'].includes(e.tagName.toLowerCase()))return!0;return["CodeMirror","cm-editor","monaco-editor","ace_editor","blob-code","file-content"].some(t=>e.classList.contains(t)||e.className.includes(t))}findActiveEditor(){const e=document.activeElement;if(e&&this.isEditor(e))return e;if(this.currentEditor&&this.isEditor(this.currentEditor))return this.currentEditor;const t=[".CodeMirror",".cm-editor",".monaco-editor",".ace_editor","textarea",'[contenteditable="true"]'];for(const e of t){const t=document.querySelectorAll(e);for(const e of t)if(this.isEditor(e)&&this.isElementVisible(e))return e}return null}isElementVisible(e){const t=e.getBoundingClientRect();return t.width>0&&t.height>0&&t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}getEditorType(e){return e.classList.contains("CodeMirror")||e.classList.contains("cm-editor")?"codemirror":e.classList.contains("monaco-editor")?"monaco":e.classList.contains("ace_editor")?"ace":"textarea"===e.tagName.toLowerCase()?"textarea":"true"===e.contentEditable?"contenteditable":"unknown"}insertTextAtCursor(e){if(!this.currentEditor)return;switch(this.getEditorType(this.currentEditor)){case"codemirror":this.insertIntoCodeMirror(e);break;case"monaco":this.insertIntoMonaco(e);break;case"ace":this.insertIntoAce(e);break;case"textarea":this.insertIntoTextarea(e);break;case"contenteditable":this.insertIntoContentEditable(e);break;default:this.insertIntoGeneric(e)}}insertIntoCodeMirror(e){const t=this.currentEditor.CodeMirror;if(t){const r=t.getCursor();t.replaceRange(e+"\n",r),t.focus()}}insertIntoMonaco(e){const t=this.currentEditor.__monacoEditor;if(t){const r=t.getPosition();t.executeEdits("headforge-insert",[{range:{startLineNumber:r.lineNumber,startColumn:r.column,endLineNumber:r.lineNumber,endColumn:r.column},text:e+"\n",forceMoveMarkers:!0}]),t.focus()}}insertIntoAce(e){const t=this.currentEditor.env?.editor;if(t){const r=t.getCursorPosition();t.session.insert(r,e+"\n"),t.focus()}}insertIntoTextarea(e){const t=this.currentEditor,r=t.selectionStart,n=t.selectionEnd,s=t.value;t.value=s.substring(0,r)+e+"\n"+s.substring(n),t.selectionStart=t.selectionEnd=r+e.length+1,t.focus(),t.dispatchEvent(new Event("input",{bubbles:!0}))}insertIntoContentEditable(e){const t=window.getSelection();if(t&&t.rangeCount>0){const r=t.getRangeAt(0);r.deleteContents();const n=document.createTextNode(e+"\n");r.insertNode(n),r.setStartAfter(n),r.setEndAfter(n),t.removeAllRanges(),t.addRange(r)}}insertIntoGeneric(e){this.currentEditor&&"true"===this.currentEditor.contentEditable?this.insertIntoContentEditable(e):this.insertIntoTextarea(e)}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"H"===e.key&&(e.preventDefault(),this.openHeadForgePopup())})}openHeadForgePopup(){chrome.runtime.sendMessage({type:"OPEN_POPUP"})}}})();
//# sourceMappingURL=content.js.map